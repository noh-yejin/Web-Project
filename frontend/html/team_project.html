<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emotion Analysis Model</title>
<link rel="stylesheet" href="../css/style_web.css">
<link href="https://fonts.googleapis.com/css2?family=Pretendard&display=swap" rel="stylesheet">
<style>
  /* ì¶”ê°€ ìŠ¤íƒ€ì¼: ë‹¬ë ¥ì˜ ë¹ˆ ì¹¸ */
  .calendar-cell.empty {
    background-color: #f0f0f0;
  }
</style>
</head>
<body>

<header class="dashboard-header">
  <h1>Emotion Analysis Model</h1>
</header>

<main class="dashboard-grid">
  <section class="input-panel">
    <h2>Today's Journal</h2>
    <form id="diary-form" method="POST">
      <label for="entry-date">Select Date:</label>
      <input type="date" id="entry-date" name="entry-date" required>
      <br><br>
      <textarea id="diary-text" name="diary-text" placeholder="Write about your day here..." required></textarea>
      <button type="submit">Analyze Emotion</button>
    </form>
  </section>

  <section class="extra-panel">
    <h2>How to Use</h2>
    <p>âœï¸ Write freely about your emotions in the journal area.</p>
    <p>ğŸ“… Select the date first to properly store the emotion data.</p>
    <p>ğŸ¤– Click 'Analyze Emotion' to let AI interpret your feelings.</p>
    <p>ğŸ“Š Check results and keywords in the statistics box.</p>
    <p>ğŸ“… The emotion calendar visualizes your mood history.</p>
  </section>

  <section class="stats-panel">
    <h2>Today's Emotion</h2>
    <div class="stats-box" id="analysis-result" style="display:none">
      <p>Predicted Sentiment: <span id="result-sentiment">-</span></p>
      <p>Extracted Keywords: <span id="result-keywords">-</span></p>
      <p style="margin-top:10px; font-weight: bold; color: #007acc;">Advice ğŸ’¡</p>
      <p id="result-advice">-</p>
    </div>
  </section>

  <section class="calendar-panel">
    <h2>Emotion Calendar</h2>
    <div class="calendar-header">
      <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
    </div>
    <div class="calendar-grid"></div>
  </section>

  <section class="chart-panel">
    <h2>Weekly Emotion Summary</h2>
    <canvas id="weeklyChart" width="100%" height="300"></canvas>
  </section>
</main>

<footer class="dashboard-footer">
  <p>Contact: <a href="mailto:emotionai@teamproject.com">emotionai@teamproject.com</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const form = document.getElementById('diary-form');
  const textarea = document.getElementById('diary-text');
  const dateInput = document.getElementById('entry-date');
  const resultBox = document.getElementById('analysis-result');
  const sentimentSpan = document.getElementById('result-sentiment');
  const keywordsSpan = document.getElementById('result-keywords');
  const advicePara = document.getElementById('result-advice');

  // â¡ï¸ ê°ì • ë¶„ì„ ê¸°ëŠ¥ (ê¸°ì¡´ê³¼ ë™ì¼)
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    const text = textarea.value.trim();
    const date = dateInput.value;
    if (!text || !date) return;

    const keywords = text.split(/\s+/).filter(word => word.length >= 2).slice(0, 3);
    const sentiments = ['Positive', 'Negative', 'Neutral'];
    const sentiment = sentiments[Math.floor(Math.random() * 3)];

    const adviceMap = {
      'Positive': 'Keep up the great energy! ğŸ˜Š',
      'Negative': 'Take a break and be kind to yourself today.',
      'Neutral': 'Even calm days are meaningful. Appreciate yourself!'
    };

    sentimentSpan.textContent = sentiment;
    keywordsSpan.textContent = keywords.join(', ');
    advicePara.textContent = adviceMap[sentiment] || '-';
    resultBox.style.display = 'block';
  });

  // â¡ï¸ ë‹¬ë ¥ ìƒì„± í•¨ìˆ˜
  function generateCalendar(year, month) {
    const calendarGrid = document.querySelector('.calendar-grid');
    calendarGrid.innerHTML = ''; // ê¸°ì¡´ ë‹¬ë ¥ ë¹„ìš°ê¸°

    const firstDay = new Date(year, month, 1).getDay(); // 0=ì¼~6=í† 
    const lastDate = new Date(year, month + 1, 0).getDate(); // ë§ˆì§€ë§‰ ë‚ ì§œ

    // ì²« ì£¼ ë¹ˆ ì¹¸
    for (let i = 0; i < firstDay; i++) {
      const emptyCell = document.createElement('div');
      emptyCell.classList.add('calendar-cell', 'empty');
      calendarGrid.appendChild(emptyCell);
    }

    // ë‚ ì§œ ì±„ìš°ê¸°
    for (let date = 1; date <= lastDate; date++) {
      const cell = document.createElement('div');
      cell.classList.add('calendar-cell');
      cell.textContent = date;
      calendarGrid.appendChild(cell);
    }
  }

  // â¡ï¸ ë‚ ì§œ ì„ íƒ ì‹œ ë‹¬ë ¥ ì—…ë°ì´íŠ¸
  dateInput.addEventListener('change', function() {
    const selectedDate = new Date(this.value);
    const year = selectedDate.getFullYear();
    const month = selectedDate.getMonth(); // 0=1ì›”~11=12ì›”
    generateCalendar(year, month);
  });

  // â¡ï¸ í˜ì´ì§€ ë¡œë“œ ì‹œ ì˜¤ëŠ˜ ë‹¬ë ¥ í‘œì‹œ
  window.addEventListener('DOMContentLoaded', () => {
    const today = new Date();
    generateCalendar(today.getFullYear(), today.getMonth());
  });

  // â¡ï¸ ì˜ˆì‹œ Chart.js ê·¸ë˜í”„
  const ctx = document.getElementById('weeklyChart').getContext('2d');
  const emotionData = [1, 2, 3, 1, 2, 2, 3];
  const backgroundColors = emotionData.map(val => {
    if (val === 1) return '#e74c3c';
    if (val === 2) return '#f39c12';
    if (val === 3) return '#2ecc71';
  });
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
      datasets: [{
        label: 'Emotion Level',
        data: emotionData,
        backgroundColor: backgroundColors,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          ticks: {
            stepSize: 1,
            callback: function(value) {
              return value === 1 ? 'Negative' :
                     value === 2 ? 'Neutral' :
                     value === 3 ? 'Positive' : value;
            }
          },
          min: 0,
          max: 3
        }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
</script>

</body>
</html>
